# TaxCat - UK VAT Classification System

TaxCat is an intelligent system for classifying UK VAT transactions using AI. It combines FastAPI backend with a Next.js frontend to provide accurate VAT classifications based on HMRC guidelines.

## Project Structure

```
taxcat/
├── frontend/           # Next.js frontend application
├── app.py             # Main FastAPI application
├── requirements.txt   # Python dependencies
├── Dockerfile        # Container configuration
├── railway.json      # Railway deployment config
├── Procfile         # Process configuration
├── data/            # Source HMRC VAT notices
│   ├── VAT Notice 700.html
│   ├── VAT Notice 700_12.html
│   ├── VAT Notice 700_21.html
│   ├── VAT Notice 741A.html
│   └── VAT Notice 735.html
└── scripts/         # Data processing scripts
    ├── ingest.py
    └── enhanced_ingest.py
```

## Data Files

The project uses two types of data files:

1. **Source HTML Files** (`data/` directory):
   - Official HMRC VAT notices
   - Included in git repository
   - Required for generating embeddings
   - Public documents from gov.uk

2. **Generated Files** (excluded from git):
   - `vat_documents.json`: Basic processed documents
   - `vat_documents_enhanced.json`: Enhanced version with detailed metadata
   - Generated by running `scripts/enhanced_ingest.py`
   - Will be created during deployment

### Ingestion Scripts

The project includes two ingestion scripts:

1. `scripts/ingest.py`:
   - Basic document processing
   - Creates simple embeddings
   - Used for development/testing

2. `scripts/enhanced_ingest.py`:
   - Advanced metadata analysis
   - Detailed transaction classification
   - Used in production
   - Generates enhanced embeddings with:
     - Business type (B2B/B2C)
     - Service type (digital/physical)
     - Geographic scope
     - VAT treatment rules
     - Confidence scores

The production deployment uses the enhanced ingestion process for better classification accuracy.

## Features

- AI-powered VAT classification
- Real-time transaction analysis
- Cross-border and digital services support
- Reverse charge handling
- RESTful API interface
- Modern web interface

## Setup

### Backend (FastAPI)

1. Create a virtual environment:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # On Windows: .venv\Scripts\activate
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

4. Run the development server:
   ```bash
   uvicorn app:app --reload
   ```

### Frontend (Next.js)

1. Navigate to the frontend directory:
   ```bash
   cd frontend
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env.local
   # Edit .env.local with your configuration
   ```

4. Run the development server:
   ```bash
   npm run dev
   ```

## Deployment

### Backend (Railway)

1. Create a Railway account
2. Connect your GitHub repository
3. Set up environment variables in Railway dashboard
4. Deploy using the provided Dockerfile

### Frontend (Vercel)

1. Create a Vercel account
2. Connect your GitHub repository
3. Set up environment variables
4. Deploy to Vercel

## Environment Variables

### Backend (.env)
- `ENVIRONMENT`: development/production
- `PORT`: API server port
- `FRONTEND_URL`: Frontend application URL
- `OPENAI_API_KEY`: OpenAI API key
- `CACHE_DIR`: Cache directory path

### Frontend (.env.local)
- `NEXT_PUBLIC_API_URL`: Backend API URL
- `NODE_ENV`: development/production

## Development Setup

### Pre-commit Hooks

The project uses pre-commit to enforce code quality and security checks. To set up:

1. Install pre-commit:
   ```bash
   pip install pre-commit
   ```

2. Install the git hooks:
   ```bash
   pre-commit install
   ```

The pre-commit configuration includes:
- Code formatting (black, isort)
- Type checking (mypy)
- Security checks (sensitive data, private keys)
- File size limits
- YAML/JSON validation
- Merge conflict detection

Note: HTML files in the `data/` directory are excluded from sensitive data checks as they are public HMRC documents.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

MIT License - see LICENSE file for details
